#!/usr/bin/env cwl-runner

class: Workflow
cwlVersion: v1.0

inputs:
  tumor:
   type: File
   secondaryFiles:
      - .bai

  normal:
    type: File
    secondaryFiles:
      - .bai

  reference:
    type: File
    secondaryFiles:
      - .fai

outputs: 
    type: File
    outputSource: varscan/snp_vcf

steps:
  normal_pileup:
   run: ../tools/samtools-pileup-tool/sam_pileup.cwl.yaml
   in:
    input:normal
    reference:reference
   out: [normal_pileup_output]

   tumor_pileup:
   run: ../tools/samtools-pileup-tool/sam_pileup.cwl.yaml
   in:
    input:tumor
    reference:reference
   out: [tumor_pileup_output]
      
  varscan:
   run: ../tools/varscan-tool/varscan_somatic.cwl.yaml
   in:
    normal_pileup: normal_pileup/normal_pileup_output
    tumor_pileup: tumor_pileup/tumour_pileup_output
   out: [snp_vcf]
